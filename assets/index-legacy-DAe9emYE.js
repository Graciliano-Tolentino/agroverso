System.register(["./react-vendor-legacy-DHjJIiN4.js","./vendor-legacy-VVuW3tU1.js"],(function(e,t){"use strict";var a,r,o,s,n,i,l,c,d,u,m,g,h,p,x,f,y,v,j;return{setters:[e=>{a=e.r,r=e.j,o=e.u,s=e.L,n=e.R,i=e.b,l=e.N,c=e.d,d=e.e,u=e.f,m=e.B,g=e.h},e=>{h=e.g,p=e.j,x=e.v,f=e._,y=e.P,v=e.A,j=e.m}],execute:function(){var w=document.createElement("style");w.textContent="@tailwind base;@tailwind components;@tailwind utilities;body{@apply bg-white text-grayIntelligent antialiased;}a{@apply transition-colors duration-200;}.footer-link{@apply text-grayIntelligent hover:text-greenRegenerative;}\n/*$vite$:1*/",document.head.appendChild(w),e("u",V);const b="agroverso_token",k="agroverso_user",S=(e,t)=>{if(!e||"string"!=typeof e)throw new Error("Token inválido: é necessário uma string JWT.");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error("Usuário inválido: é necessário um objeto JSON.");localStorage.setItem(b,e),localStorage.setItem(k,JSON.stringify(t))},N=()=>localStorage.getItem(b),E=()=>{localStorage.removeItem(b),localStorage.removeItem(k)},A=h.create({baseURL:"https://api.agroverso.tec.br/internal",withCredentials:!0}),P=(e,t=60)=>{try{const a=p(e),r=Math.floor(Date.now()/1e3);return a.exp<=r+t}catch(a){return!0}};let I=!1,C=[];const R=async()=>{try{const e=await A.post("/auth/refresh",{},{withCredentials:!0}),{token:t,user:a}=e.data;if(!t||!a)throw new Error("Resposta inválida ao renovar token");return S(t,a),t}catch(e){return E(),null}};A.interceptors.request.use((async e=>{let t=N();if(t&&P(t)){if(!I){I=!0;try{const e=await R();t=e,(e=>{C.forEach((t=>t(e))),C=[]})(e)}catch(a){}finally{I=!1}}return new Promise((t=>{var a;a=a=>{a&&e?.headers&&(e.headers.Authorization=`Bearer ${a}`),t(e)},C.push(a)}))}return t&&e?.headers&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e))),A.interceptors.response.use((e=>e),(async e=>{const t=e.config;if(401===e.response?.status&&!t._retry){t._retry=!0;try{const e=await R();if(e)return t.headers.Authorization=`Bearer ${e}`,A(t)}catch(a){}}return Promise.reject(e)}));const _=async(e,t)=>{if(!e||"string"!=typeof e)throw new Error("Email inválido");if(!t||"string"!=typeof t)throw new Error("Senha inválida");const a=await A.post("/auth/login",{email:e,senha:t}),{token:r,user:o}=a.data;if(!r||P(r))throw new Error("Token inválido ou expirado");return S(r,o),{token:r,user:o}},L=()=>{E()},D=async()=>(await A.get("/auth/me")).data,$=e("A",a.createContext(void 0));$.displayName="AuthContext";const z=({children:e})=>{const[t,o]=a.useState((()=>{try{const e=localStorage.getItem(k);return e?JSON.parse(e):null}catch(e){return null}})()),[s,n]=a.useState(N()),[i,l]=a.useState(!!N()),[c,d]=a.useState(!0),[u,m]=a.useState(null),[g]=a.useState((()=>x()));a.useEffect((()=>{(async()=>{if(!N())return E(),l(!1),void d(!1);try{{const e=await D();o(e),l(!0)}}catch(e){p(!1)}finally{d(!1)}})()}),[g]);const h=async(e,t)=>{d(!0),m(null);try{{const{token:a,user:r}=await _(e,t);S(a,r),n(a),o(r),l(!0)}}catch(a){m(a.message||"Erro ao fazer login."),l(!1)}finally{d(!1)}},p=(e=!0)=>{L?.(),E(),o(null),n(null),l(!1),m(null)},f=a.useMemo((()=>Object.freeze({user:t,token:s,isAuthenticated:i,loading:c,error:u,login:h,logout:p,setError:m,traceId:g})),[t,s,i,c,u,g]);return r.jsx($.Provider,{value:f,children:e})};function O(){const{login:e,isAuthenticated:t,error:n,loading:i,setError:l}=a.useContext($),[c,d]=a.useState({email:"",senha:""}),u=o();a.useEffect((()=>(t&&u("/admin"),()=>{l(null)})),[t,u,l]);const m=e=>{const{name:t,value:a}=e.target;d((e=>({...e,[t]:a}))),n&&l(null)};return r.jsx("main",{className:"min-h-screen flex items-center justify-center bg-gradient-to-tr from-green-50 via-white to-green-100 p-6",children:r.jsxs("section",{className:"bg-white shadow-2xl rounded-2xl px-8 py-10 w-full max-w-md animate-fade-in",children:[r.jsxs("h1",{className:"text-3xl font-extrabold text-center text-green-700 mb-6 tracking-tight",children:["Acesso Administrativo – ",r.jsx("span",{className:"text-green-500",children:"Agroverso"})]}),n&&r.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4 text-sm","aria-live":"polite",role:"alert",children:["⚠️ ",n]}),r.jsxs("form",{onSubmit:async t=>{t.preventDefault(),c.email&&c.senha?await e(c.email,c.senha):l("Por favor, preencha todos os campos.")},className:"space-y-5",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-semibold mb-1",children:"E-mail"}),r.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"username",value:c.email,onChange:m,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 transition"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"senha",className:"block text-gray-700 font-semibold mb-1",children:"Senha"}),r.jsx("input",{id:"senha",name:"senha",type:"password",autoComplete:"current-password",value:c.senha,onChange:m,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 transition"})]}),r.jsx("button",{type:"submit",disabled:i,className:"w-full font-bold py-2 rounded-lg text-white transition duration-200 "+(i?"bg-green-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"),"aria-busy":i,children:i?"Entrando...":"Entrar"})]}),r.jsxs("div",{className:"text-center text-sm text-gray-500 mt-6",children:["Não tem uma conta?"," ",r.jsx(s,{to:"/register",className:"text-green-600 font-medium hover:underline",children:"Cadastre-se"})]}),r.jsx("div",{className:"text-center mt-4",children:r.jsx(s,{to:"/",className:"text-xs text-gray-400 hover:text-green-600 transition","aria-label":"Voltar para a página inicial",children:"← Voltar para o site"})})]})})}const T=()=>r.jsx("section",{className:"bg-gray-50 min-h-screen flex items-center justify-center",children:r.jsxs("div",{className:"text-center p-8",children:[r.jsx("img",{src:"/assets/images/logo_agroverso.png",alt:"Logotipo da Agroverso",className:"w-20 mx-auto",loading:"eager"}),r.jsx("h1",{className:"text-4xl text-greenRegenerative font-montserrat mt-4",children:"404 - Página não encontrada"}),r.jsx("p",{className:"text-gray-700 font-opensans mt-2 mb-6",children:"Desculpe, a página que você procura não existe ou foi movida."}),r.jsx(s,{to:"/",className:"inline-block bg-greenRegenerative text-white font-opensans font-semibold py-2 px-4 rounded hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-greenRegenerative focus:ring-offset-2 focus:ring-offset-gray-50",children:"Voltar à Página Inicial"})]})}),U=n.lazy((()=>f((()=>t.import("./HomePage-legacy-B0WguC2Z.js")),void 0))),B=n.lazy((()=>f((()=>t.import("./SobrePage-legacy-BA5V6hRL.js")),void 0))),F=n.lazy((()=>f((()=>t.import("./ContatoPage-legacy-DvMDXdau.js")),void 0))),M=n.lazy((()=>f((()=>t.import("./CertificadosPage-legacy-BUuq4UV4.js")),void 0))),q=n.lazy((()=>f((()=>t.import("./ValidarPage-legacy-Cmhrs8kH.js")),void 0))),J=[{index:!0,element:r.jsx(U,{})},{path:"/sobre",element:r.jsx(B,{})},{path:"/contato",element:r.jsx(F,{})},{path:"/certificados",element:r.jsx(M,{})},{path:"/validar/:codigo",element:r.jsx(q,{})},{path:"/login",element:r.jsx(O,{})},{path:"*",element:r.jsx(T,{})}];function V(e="default",t={}){a.useEffect((()=>{(new Date).toISOString();!function(){try{(new Date).toISOString(),Math.random().toString(36).substring(2,10),Date.now().toString(36),navigator.userAgent,navigator.language}catch(e){}}()}),[e,t])}function G(){const{t:e}=i(),{logEvent:t}=V("admin:usuarios"),[o,s]=a.useState([]),[n,l]=a.useState(!0);return a.useEffect((()=>{t("admin_usuarios_view",{timestamp:Date.now(),origem:"Admin > Usuários"});const e=setTimeout((()=>{s([{id:1,nome:"João da Silva",email:"joao@agroverso.tec.br",papel:"Administrador",ativo:!0},{id:2,nome:"Ana Beatriz",email:"ana@agroverso.tec.br",papel:"Moderadora",ativo:!1},{id:3,nome:"Carlos Eduardo",email:"carlos@agroverso.tec.br",papel:"Usuário",ativo:!0}]),l(!1)}),800);return()=>clearTimeout(e)}),[]),n?r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",role:"status",children:e("geral.carregando","Carregando usuários...")}):r.jsxs("section",{className:"p-6 space-y-6",role:"region","aria-label":e("usuarios.aria.secao","Painel de usuários cadastrados"),children:[r.jsxs("header",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2 card-heading",children:e("usuarios.titulo","Usuários")}),r.jsx("p",{className:"text-gray-700 dark:text-gray-300 card-body",children:e("usuarios.descricao","Gerencie permissões, status e acesso de usuários.")})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full bg-white dark:bg-gray-900 rounded-lg shadow-md","aria-label":e("usuarios.aria.tabela"),children:[r.jsx("caption",{className:"text-left text-sm text-gray-500 dark:text-gray-400 mb-2",children:e("usuarios.legenda","Tabela com dados dos usuários do sistema")}),r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-4 py-2 text-left",children:e("usuarios.coluna.nome")}),r.jsx("th",{scope:"col",className:"px-4 py-2 text-left",children:e("usuarios.coluna.email")}),r.jsx("th",{scope:"col",className:"px-4 py-2 text-left",children:e("usuarios.coluna.papel")}),r.jsx("th",{scope:"col",className:"px-4 py-2 text-left",children:e("usuarios.coluna.status")})]})}),r.jsx("tbody",{children:o.map((t=>r.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700","data-testid":`usuario:linha-${t.id}`,children:[r.jsx("td",{className:"px-4 py-2 text-gray-800 dark:text-white",children:t.nome}),r.jsx("td",{className:"px-4 py-2 text-gray-800 dark:text-white",children:t.email}),r.jsx("td",{className:"px-4 py-2 text-gray-800 dark:text-white",children:t.papel}),r.jsx("td",{className:"px-4 py-2",children:r.jsx("span",{className:"badge "+(t.ativo?"bg-green-200 text-green-800":"bg-red-200 text-red-800"),role:"status","aria-label":t.ativo?e("usuarios.ativo"):e("usuarios.inativo"),"data-testid":`usuario:status-${t.id}`,children:t.ativo?e("usuarios.ativo","Ativo"):e("usuarios.inativo","Inativo")})})]},t.id)))})]})})]})}const W=[{key:"usuarios",path:ROUTES.ADMIN.USUARIOS,element:r.jsx(G,{}),meta:{id:"usuarios",order:1,title:"Usuários",icon:r.jsx(Users,{}),roles:["admin"],breadcrumb:"Gestão de Usuários"}}],H=n.lazy((()=>f((()=>t.import("./AdminRelatoriosPage-legacy-Cy1KYHbG.js")),void 0))),K=[{path:"relatorios",element:r.jsx(H,{}),meta:{title:"Relatórios",icon:"bar-chart",roles:["admin"],breadcrumb:"Relatórios do Sistema"}}],Q=n.lazy((()=>f((()=>t.import("./AdminCursosPage-legacy-C6B8MLiq.js")),void 0))),X=[{path:"cursos",element:r.jsx(Q,{}),meta:{title:"Cursos",icon:"book",roles:["admin","instrutor"],breadcrumb:"Gerenciar Cursos"}}],Y=n.lazy((()=>f((()=>t.import("./AdminPage-legacy-DlogeBGh.js")),void 0))),Z=n.lazy((()=>f((()=>t.import("./AdminDashboardPage-legacy-m2ONaWtU.js")),void 0))),ee=[{path:"/admin",element:r.jsx(Y,{}),children:[{index:!0,element:r.jsx(Z,{}),meta:{title:"Painel",icon:"dashboard",roles:["admin"],breadcrumb:"Painel Administrativo"}},...W,...K,...X,{path:"*",element:r.jsx(l,{to:"/admin",replace:!0}),meta:{hidden:!0}}]}],te=n.lazy((()=>f((()=>t.import("./DefaultLayout-legacy-D8VvpiWy.js")),void 0)));n.lazy((()=>f((()=>t.import("./AdminLayout-legacy-DlUemNqQ.js")),void 0)));const ae={public:r.jsx(te,{})},re={expirado:{pt:"⏰ Sessão expirada. Por favor, faça login novamente.",en:"⏰ Session expired. Please log in again."}},oe={fallback403:{titulo:"Acesso negado",mensagem:"Você não possui permissão para acessar esta área do sistema.",recomendacao:"Verifique se está autenticado e se possui permissões adequadas.",codigo:403},tokenPublico:null,apiBaseUrl:"https://api.agroverso.tec.br/internal"},se=new Map;function ne(e,t=2e3){const a=Date.now();return!(a-(se.get(e)||0)<t||(se.set(e,a),0))}function ie(e){const t=JSON.parse(localStorage.getItem("agroverso_logs")||"[]");t.push(e),localStorage.setItem("agroverso_logs",JSON.stringify(t))}function le(e){const t=function(e){const t={...e};return delete t.token,delete t.password,delete t.secret,t}(e),{level:a="info",message:r,stack:o,...s}=t;!function(e,t,a,r){if(!window.Sentry?.captureException)return;const o=new Error(t);a&&(o.stack=a),window.Sentry["error"===e?"captureException":"captureMessage"](o,{level:e,extra:r})}(a,r,o,s),function(e,t,a,r){window.LogRocket?.log&&window.LogRocket.log(`[${e.toUpperCase()}] ${t}`,{...r,...a&&{stack:a}})}(a,r,o,s),function(e,t,a,r){window.DD_LOGS?.logger?.[e]&&window.DD_LOGS.logger[e](t,{...r,...a&&{stack:a}})}(a,r,o,s),function(e,t,a,r){window.dataLayer&&window.dataLayer.push({event:`logger_${e}`,message:t,stack:a||"",...r})}(a,r,o,s)}const ce=(...e)=>le({level:"info",message:e.join(" ")}),de=[];function ue(e,t="ativo"){const{userRole:a,esperado:r,rota:o}=e;if("undefined"==typeof window)return;const s={traceId:`trace_${Math.random().toString(36).substring(2,8)}_${Date.now().toString(36)}`,userRole:a,expectedRoles:r,path:o,timestamp:(new Date).toISOString()};try{!function(e){if("undefined"!=typeof window)try{window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"acesso_negado_rbac",...e})}catch(t){}}(s)}catch(n){}try{!function(e){if("undefined"!=typeof window)try{window.LogRocket?.track?.("rbac_block",e)}catch(n){}}(s)}catch(n){}try{!function(e){if("undefined"!=typeof window)try{window.DD_LOGS?.logger?.info?.("RBAC_BLOCK",e)}catch(n){}}(s)}catch(n){}de.sort(((e,t)=>t.prioridade-e.prioridade)).forEach((({fn:e,silencioso:t})=>{try{e(s)}catch(n){if(!t)throw n}}))}const me=oe.fallback403??"/403",ge=a.lazy((()=>f((()=>t.import("./AvisoRedirecionamento-legacy-ApcyBr0b.js")),void 0))),he=({children:e,roles:t=[],visualFallback:o=null,mensagemFallback:s,fallback403:n=me})=>{const i=c(),{user:l,token:d,loading:u}=function({fallbackIfEmpty:e=!1}={}){const t=a.useContext($);if(!t&&e)return{user:null,token:null,isAuthenticated:!1,loading:!1,error:null,login:()=>{},logout:()=>{},setError:()=>{},traceId:null};if(!t)throw new Error("[useAuth] Este hook deve ser usado dentro de <AuthProvider>.");return t}(),m=i.pathname,g=a.useMemo((()=>"string"==typeof t?[t]:t),[t]),h=s??((x=m).startsWith("/admin")?re.verificandoAdmin:x.startsWith("/user")?re.verificandoUser:re.verificandoPadrao);var x;const{erros:f}=function({token:e,user:t,roles:a=[]}){const r=[],o={status:null,mensagem:null};if(e)try{const{exp:t}=p(e);Date.now()>=1e3*t&&(localStorage.removeItem("token"),r.push("498"),o.status="498",o.mensagem="Token expirado")}catch(i){localStorage.removeItem("token"),r.push("498"),o.status="498",o.mensagem="Token malformado"}else r.push("401"),o.status="401",o.mensagem="Token ausente";const s=Array.isArray(t?.roles)?t.roles:[t?.role],n=0===a.length||a.some((e=>s.includes(e)));return t&&!n&&(r.push("403"),o.status="403",o.mensagem="Permissão negada para esta rota"),{autorizado:n,erros:r,tipoBloqueio:o}}({token:d,user:l,roles:g}),y=({mensagem:e,destino:t,tempo:o=3e3})=>r.jsx(a.Suspense,{fallback:r.jsx("div",{role:"status","aria-live":"assertive",className:"text-center py-4 text-gray-600 dark:text-gray-400",children:"Verificando acesso..."}),children:r.jsx(ge,{tempo:o,destino:t,fallback:"/",mensagem:e})});if(u)return o??y({mensagem:h});const v=new Set(f);return v.has("401")||v.has("498")?(ce("[ProtectedRoute] Sessão inválida ou expirada",{token:d,rota:m}),y({mensagem:re.expirado,destino:"/login"})):v.has("403")?(ue({userRole:l?.role??"__undefined__",esperado:g,rota:m}),y({mensagem:re.negado,destino:n})):o?r.jsx(a.Suspense,{fallback:o,children:e}):e},pe={children:y.node.isRequired,roles:y.oneOfType([y.arrayOf(y.string),y.string]),visualFallback:y.node,mensagemFallback:y.string,fallback403:y.string};he.propTypes=pe,he.defaultProps={roles:[],visualFallback:null,mensagemFallback:null,fallback403:"/403"},he.displayName="ProtectedRoute";const xe=()=>r.jsx("div",{className:"flex h-screen w-full items-center justify-center text-lg text-gray-700",children:"Carregando…"}),fe=({children:e})=>{const t=c();return r.jsx(v,{mode:"wait",children:r.jsx(j.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},transition:{duration:.2},children:e},t.pathname)})};function ye(){return a.useEffect((()=>{const e=setTimeout((()=>{f((()=>t.import("./CertificadosPage-legacy-BUuq4UV4.js")),void 0),f((()=>t.import("./ValidarPage-legacy-Cmhrs8kH.js")),void 0)}),1200);return()=>clearTimeout(e)}),[]),r.jsxs(d,{children:[r.jsx(u,{element:r.jsx(a.Suspense,{fallback:r.jsx(xe,{}),children:ae.public}),children:J.map(((e,t)=>r.jsx(u,{path:e.path,index:e.index,element:r.jsx(a.Suspense,{fallback:r.jsx(xe,{}),children:r.jsx(fe,{children:e.element})})},`public-${t}`)))}),ee.map(((e,t)=>r.jsx(u,{path:e.path,element:r.jsx(he,{roles:["admin"],visualFallback:r.jsx(xe,{}),children:r.jsx(a.Suspense,{fallback:r.jsx(xe,{}),children:e.element})}),children:e.children?.map(((e,t)=>r.jsx(u,{path:e.path,index:e.index,element:r.jsx(a.Suspense,{fallback:r.jsx(xe,{}),children:r.jsx(fe,{children:e.element})})},`admin-child-${t}`)))},`admin-${t}`)))]})}const ve=a.createContext();function je({children:e}){const[t,o]=a.useState("light");return a.useEffect((()=>{const e=localStorage.getItem("theme");if("dark"===e||"light"===e)o(e);else{const e=window.matchMedia("(prefers-color-scheme: dark)").matches;o(e?"dark":"light")}}),[]),a.useEffect((()=>{const e=document.documentElement;e.classList.remove("dark"===t?"light":"dark"),e.classList.add(t),localStorage.setItem("theme",t)}),[t]),r.jsx(ve.Provider,{value:{theme:t,toggleTheme:()=>{o((e=>"light"===e?"dark":"light"))}},children:e})}function we({component:e="App",context:t="App Boot",offlineFallback:r=!0}={}){a.useEffect((()=>{JSON.parse(localStorage.getItem("agroverso_logs")||"[]").forEach((e=>le(e))),localStorage.removeItem("agroverso_logs");const a=(a,o,s,n,i)=>{if(!ne(`${e}::${a}`))return;const l={level:"error",message:a,stack:i?.stack||`at ${o}:${s}:${n}`,component:e,context:t,type:"window.onerror",timestamp:(new Date).toISOString()};try{le(l)}catch{r&&ie(l)}},o=a=>{const o=a.reason||{};if(!ne(`${e}::${o.message||"Rejeição silenciosa"}`))return;const s={level:"error",message:o.message||"Rejeição de promessa não tratada",stack:o.stack||o.toString()||null,component:e,context:t,type:"unhandledrejection",timestamp:(new Date).toISOString()};try{le(s)}catch{r&&ie(s)}};return window.addEventListener("error",a),window.addEventListener("unhandledrejection",o),()=>{window.removeEventListener("error",a),window.removeEventListener("unhandledrejection",o)}}),[e,t,r])}function be(){return we({component:"App",context:"Inicialização da aplicação",offlineFallback:!0}),r.jsx(je,{children:r.jsx(z,{children:r.jsx(m,{children:r.jsx(ye,{})})})})}ve.displayName="ThemeContext";const ke=document.getElementById("root");g.createRoot(ke).render(r.jsx(n.StrictMode,{children:r.jsx(be,{})})),"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js").then((e=>{})).catch((e=>{}))}))}}}));
